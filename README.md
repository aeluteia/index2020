# Ranking Digital Rights - 2020 Corporate Accountability Index

> Surveying internet and telecommunications companies on user privacy and freedom of expression

## I want to do ...

There are a few common tasks that developers and administrators of this website want to commonly do. This is a summary of each of these tasks and recipes on how to them. All of those tasks are executed on the terminal. Please see [Setup Development Environment](#setup-development-environment) and make sure the environment and dependencies are set up.

### Fetch the latest version

```sh
git pull
yarn install
```

### Commit data changes

```sh
git add data
git commit -m "update website data"
git push
```

### Deploy website

The website can be deployed to staging or to production. The deploy works such that it builds the complete website locally on your own computer and then copies your version of the website to the remote server.

#### Deploy to staging

```sh
yarn deploy
```

#### Deploy to production

Use the `-p` flag to deploy to production instead.

```sh
yarn deploy -p
```

### Update HTML meta tags

1. [Fetch the latest version](#fetch-the-latest-version).
2. Edit [`data/html-meta.json`](./data/html-meta-json) and update fields as needed. The file is in JSON format and consists of keys and values. Each key generates one entry in the HTML `<head>` section in the form of `<meta name="<key>" content="<value>" />`. The only required keys in this file are `title` and `description`. The other keys are taken as they are.
3. [Commit data changes](#commit-data-changes)
4. [Deploy website](#deploy-website)

## Setup Development Environment

Make sure to have a recent version of [NodeJS](https://nodejs.org). This project is developed using NodeJS 12. Further, install the [Yarn package manager](https://yarnpkg.com/).

To fetch the editorial content from Google Docs the authentication token for Google Drive has to be placed in the `./.auth.json` file in the repository root.

### Dependencies

Install all dependencies,

```sh
yarn install
```

### Development server

```sh
yarn install
yarn dev
```

Open [http://localhost:3000/index2020](http://localhost:3000/index2020) with your browser to see the result.

### Verify

```sh
yarn verify
```

This will run `yarn lint` and `yarn type-check`.

### Storybook

There is a [Storybook](https://storybook.js.org/) for UI component development.

```sh
yarn storybook
```

The Storybook is accessible at `http://localhost:6006`.

### Navigation

The navigation structure is defined as a JSON file in [`data/navigation.json`](data/navigation.json). This file generated by calling `yarn navigation`, which loads the companies and indicators from CSV, and dynamically generates the final menu structure. Edit [`src/navigation.ts`](src/navigation.ts) to modify the menu template. The menu structure can be defined recursively, but the `Navigation` component will render menu nodes only 2 levels deep.

## `indexctl`

The `bin/indexctl.ts` script provides operational support for the index 2020. The command can be invoked with `yarn indexctl`. See all available commands by calling `yarn indexctl -h`.
